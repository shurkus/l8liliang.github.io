---
layout: article
tags: Linux
title: PCIe
mathjax: true
key: Linux
---

## domain
```
domain应该不是socket序号。

gigabyte-r120-01.rhts.eng.pek2.redhat.com

这这台机器上，只有一个socket：
[root@gigabyte-r120-01 ~]# lscpu
Architecture:        aarch64
Byte Order:          Little Endian
CPU(s):              32
On-line CPU(s) list: 0-31
Thread(s) per core:  1
Core(s) per cluster: 16
Socket(s):           1

但却有下面这些domain：
[root@gigabyte-r120-01 ~]# lspci -D | awk -F ":" '{print $1}'| sort|uniq
0000
0001
0002
0004
0006

https://stackoverflow.com/questions/49050847/how-is-pci-segmentdomain-related-to-multiple-host-bridgesor-root-bridges

下面是我基于这篇文章的一些理解：

linux中，domain号的意思是：
  对于PCI，代表的是Host Bridge号，
  对于PCIe，代表的是PCI complex root (PCR)号，
  Host Bridge和PRC的功能类似，都是链接CPU和PCI/PCIe system的桥梁。

所以linux系统中有几个domain取决于硬件有几个Host Bridge/PCR。

另外，
linux中的domain号和PCI规范里面的domain号，指的算是一个意思。
linux中的domain号和PCIe规范里面的domain号，指的不是一个意思，
  PCIe规范中每一个root port都有一个domain（它这个domain是用来控制流量路由的，所以和linux中domain的意思不一样）
  PCIe规范中的PCI segment group和linux中的domain是一个意思。

```
